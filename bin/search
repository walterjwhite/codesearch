#!/bin/sh

. _LIBRARY_PATH/git-helpers/include.sh

for _ARG in $@
do
    case $_ARG in
        -a)
            _ALL=1
            shift
            ;;
        -b=*)
            _BRANCH="${_ARG#*=}"
            shift
            ;;
        -p=*)
            _PROJECT="${_ARG#*=}"
            shift
            ;;
        -l)
            _LIST_FILES=1
            shift
            ;;
        *)
            _SEARCH_ARGS="$_ARG"
            ;;
    esac
done

_do_search() {
    if [ -n "$_LIST_FILES" ]
    then
        . _LIBRARY_PATH/_APPLICATION_NAME/include.sh\
            | sed -e "s/\:.*$//"\
            | sort -u
    else
        . _LIBRARY_PATH/_APPLICATION_NAME/include.sh
    fi
}

_search() {
    cd $_PROJECT_BASE_PATH/$_PROJECT

    _ORIGINAL_BRANCH=$(gcb)
    gco $_BRANCH

    _do_search

    gco "$_ORIGINAL_BRANCH"
}

_FUNCTION="csearch $_SEARCH_ARGS"

if [ -n "$_ALL" ]
then
    for _PROJECT in $(ls ~/.csearch)
    do
        for _BRANCH in $(ls ~/.csearch/$_PROJECT)
        do
            _search
        done
    done
else
    _do_search
fi
