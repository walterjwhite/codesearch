#!/bin/sh

. _LIBRARY_PATH_/git/include.sh
. _LIBRARY_PATH_/install/logging.sh

cd $_PROJECT_BASE_PATH

for _PROJECT in $(find . -type d | grep \\.git$ | sed -e "s/\/\.git$//")
do
    cd $_PROJECT

    # TODO: support all branches too
    _ORIGINAL_BRANCH=$(gcb)
    for _BRANCH in $(gb)
    do
        # ensure we have no changes before checking out another branch
        gco $_BRANCH

        if [ "$?" -gt "0" ]
        then
            exitWithError "Unable to checkout branch due to error" 1
        fi

        index
    done

    # switch back to original branch
    gco $_ORIGINAL_BRANCH

    cd ..
done
